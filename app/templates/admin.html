{% extends "base.html" %}
{% block title %}Painel Admin - EcoPredict{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-0">
                <i class="fas fa-cog me-2"></i>
                Painel Administrativo
            </h1>
            <p class="text-muted">Gerencie o sistema e usuários</p>
        </div>
    </div>

    <!-- Admin Statistics -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card card-custom bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="card-title text-white mb-0">{{ total_users }}</h4>
                            <p class="card-text text-white-50 mb-0">Usuários</p>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="fas fa-users fa-2x text-white-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card card-custom bg-success text-white">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="card-title text-white mb-0">{{ total_datasets }}</h4>
                            <p class="card-text text-white-50 mb-0">Datasets</p>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="fas fa-database fa-2x text-white-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card card-custom bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="card-title text-white mb-0">{{ total_models }}</h4>
                            <p class="card-text text-white-50 mb-0">Modelos ML</p>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="fas fa-brain fa-2x text-white-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card card-custom {% if system_health == 'healthy' %}bg-success{% else %}bg-danger{% endif %} text-white">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="card-title text-white mb-0">{{ system_health|title }}</h4>
                            <p class="card-text text-white-50 mb-0">Status do Sistema</p>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="fas fa-heartbeat fa-2x text-white-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Recent Users -->
        <div class="col-lg-6">
            <div class="card card-custom">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-user-plus me-2"></i>
                        Usuários Recentes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Usuário</th>
                                    <th>Email</th>
                                    <th>Data de Registro</th>
                                    <th>Admin</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>
                                        <i class="fas fa-user me-2"></i>
                                        {{ user.username }}
                                    </td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                                    <td>
                                        {% if user.is_admin %}
                                            <span class="badge bg-success">Sim</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Não</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Actions -->
        <div class="col-lg-6">
            <div class="card card-custom">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tools me-2"></i>
                        Ações do Sistema
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <button class="btn btn-outline-primary w-100" onclick="runDataCleanup()">
                                <i class="fas fa-broom me-2"></i>
                                Limpeza de Dados
                            </button>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-outline-success w-100" onclick="updateMLModels()">
                                <i class="fas fa-sync-alt me-2"></i>
                                Retreinar Modelos
                            </button>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-outline-warning w-100" onclick="generateSystemReport()">
                                <i class="fas fa-file-alt me-2"></i>
                                Gerar Relatório do Sistema
                            </button>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-outline-info w-100" onclick="backupDatabase()">
                                <i class="fas fa-download me-2"></i>
                                Backup do Banco de Dados
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Information -->
            <div class="card card-custom mt-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Informações do Sistema
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-12">
                            <strong>Versão:</strong> EcoPredict v1.0.0
                        </div>
                        <div class="col-12">
                            <strong>Última Manutenção:</strong> {{ now.strftime('%d/%m/%Y %H:%M') }}
                        </div>
                        <div class="col-12">
                            <strong>Status do Banco:</strong> <span class="badge bg-success">Conectado</span>
                        </div>
                        <div class="col-12">
                            <strong>Armazenamento:</strong> 2.5GB / 10GB
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function runDataCleanup() {
    if (confirm('Executar limpeza de dados? Isso pode levar alguns minutos.')) {
        // Simulate API call
        setTimeout(() => {
            alert('Limpeza de dados concluída com sucesso!');
        }, 2000);
    }
}

function updateMLModels() {
    if (confirm('Retreinar todos os modelos? Isso pode levar algum tempo.')) {
        // Simulate API call
        setTimeout(() => {
            alert('Modelos retreinados com sucesso!');
        }, 3000);
    }
}

function generateSystemReport() {
    // Simulate report generation
    setTimeout(() => {
        alert('Relatório do sistema gerado com sucesso!');
    }, 1500);
}

function backupDatabase() {
    if (confirm('Criar backup do banco de dados?')) {
        // Simulate backup process
        setTimeout(() => {
            alert('Backup criado com sucesso!');
        }, 2500);
    }
}
</script>
{% endblock %}